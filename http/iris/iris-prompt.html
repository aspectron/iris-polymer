<dom-module id="iris-prompt">
	<style>
		.field{width:100%; min-width: 200px;margin-bottom:10px;}
	</style>
	<template>
		<paper-dialog id="dialodBox" modal>
			<h2>[[data.title]]</h2>
			<div>[[data.text]]</div>
			<div class="dialog-contents" hidden$="[[!data.isprompt]]">
				<paper-input class="field" type="[[data.fieldType]]" no-float-label value="{{data.value}}" on-keyup="onkeyup"></paper-input>
			</div>
			<div class="buttons">
				<paper-button on-click="cancel" dialog-dismiss raised hidden$="[[!data.hasCloseBtn]]">[[data.closeBtn]]</paper-button>
				<paper-button on-click="done" raised>[[data.okBtn]]</paper-button>
			</div>
		</paper-dialog>
	</template>
	<script>
		window.IRIS = window.IRIS || {};
		window.IRIS.Prompt = function(args, callback){
			var data = _.extend({
				text: '',
				okBtn: '<%= _T("OK") %>',
				closeBtn: '<%= _T("CLOSE") %>',
				fieldType: 'text',
				required: true,
				isprompt: true,
				hasCloseBtn: true,
				callback: callback
			}, args);
			this.irisPrompt.set('data', data);
			this.irisPrompt.open();
		};
		window.IRIS.Alert = function(args, callback){
			var data = _.extend({
				text: '',
				okBtn: '<%= _T("OK") %>',
				closeBtn: '<%= _T("CLOSE") %>',
				isprompt: false,
				required: false,
				hasCloseBtn: false,
				callback: callback
			}, args);
			this.irisPrompt.set('data', data);
			this.irisPrompt.open();
		};

		window.IRIS.Confirm = function(args, callback){
			var data = _.extend({
				text: '',
				okBtn: '<%= _T("OK") %>',
				closeBtn: '<%= _T("CANCEL") %>',
				isprompt: false,
				required: false,
				hasCloseBtn: true,
				callback: callback
			}, args);
			this.irisPrompt.set('data', data);
			this.irisPrompt.open();
		};

		Polymer({
			is:'iris-prompt',
			properties:{
				data:{
					type: Object,
					value: {
						value: "",
						title: "Prompt",
						text: "Enter Value",
						okBtn: 'OK',
						closeBtn: 'CLOSE',
						fieldType: 'text',
						required: true,
						isprompt: true,
						hasCloseBtn: true,
						callback: false
					}
				},
				holder: {
					type: String,
					value: "IRIS"
				}
			},
			onkeyup: function(e){
				if (e.which != 13)
					return;
				this.doCallback('ok');
			},
			done: function(){
				this.doCallback('ok');
			},
			cancel: function(){
				this.doCallback('cancel');
			},
			toggle:function(){
				this.$.dialodBox.toggle();
			},
			open:function(){
				this.$.dialodBox.open();
			},
			close:function(){
				this.$.dialodBox.close();
			},
			doCallback: function(btn, value){
				var self = this;
				var data = self.data;
				var value = data.value;
				if (data.required && btn == 'ok' && !value) {
					return;
				};
				self.close();
				if(data.callback){
					data.callback(btn, value);
				}
			},
			attached: function(){
				window[this.holder] && (window[this.holder].irisPrompt = this);
				window.IRIS.irisPrompt = this;
			}
		})
	</script>
</dom-module>

